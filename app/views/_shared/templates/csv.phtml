<?php
/* data to format */
$data = is_array($data) ? $data : array($data);
/* delimiter between fields */
$delimiter = $delimiter ?: ',';

/* mime type for the content */
header("Content-type: text/csv");
/* opening of the output buffer */
$buffer = fopen('php://output', 'w');
foreach ($data as $key) {
    fputcsv($buffer, get_object_vars($key), $delimiter);
}
fclose($buffer);
